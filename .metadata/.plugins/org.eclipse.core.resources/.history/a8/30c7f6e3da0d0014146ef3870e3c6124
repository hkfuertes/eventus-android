package es.hkapps.eventus;

import java.util.List;
import java.util.concurrent.ExecutionException;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import es.hkapps.eventus.api.RequestTask;
import es.hkapps.eventus.api.RequestTask.RequestListener;
import es.hkapps.eventus.api.User;
import android.app.ListActivity;
import android.os.Bundle;
import android.util.Log;
import android.widget.ArrayAdapter;

public class UserActivity extends ListActivity implements RequestListener {

	private RequestTask task;
	private ArrayAdapter<String> adapter;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		
		task = new RequestTask();
        task.setRequestListener(this);
        try {
			String texto = task.execute(User.URL).get();
			Log.d("usuarios", texto);
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (ExecutionException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		
	    String[] values = new String[] { "Android", "iPhone", "WindowsMobile",
	        "Blackberry", "WebOS", "Ubuntu", "Windows7", "Max OS X",
	        "Linux", "OS/2" };
	    adapter = new ArrayAdapter<String>(this,
	        android.R.layout.simple_list_item_1, values);
	    setListAdapter(adapter);
	}

	@Override
	public void onRequestCompleted(String response) {
		try {
			JSONObject jObj = new JSONObject(response);
			JSONArray usuarios = jObj.getJSONArray("usuarios");
			String[]  values = new String[usuarios.length()];
			for(int i=0; i<usuarios.length(); i++){
				values[i] = usuarios.getString(i);
				Log.d("usuarios",values[i]);
			}
			adapter = new ArrayAdapter<String>(this,android.R.layout.simple_list_item_1, values);
			adapter.notifyDataSetChanged();
		} catch (JSONException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
	}
}
